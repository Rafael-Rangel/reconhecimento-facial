# .github/workflows/indexar-albums.yml
name: Indexar √Ålbuns Diariamente

on:
  schedule:
    - cron: '0 3 * * *' # Todo dia √†s 3:00 AM (UTC)
  workflow_dispatch: # Permite executar manualmente

jobs:
  indexar:
    runs-on: ubuntu-latest
    steps:
      - name: Indexar Todos os √Ålbuns
        run: |
          # 1. Buscar lista de √°lbuns
          echo "üîç Buscando lista de √°lbuns..."
          ALBUMS=$(curl -s "https://dev.uvfotoevideo.com.br/api/main/folders" | jq -r '.folders[] | select(.name | ascii_downcase != "fotoscapas") | .id')
          
          # 2. Indexar cada √°lbum
          for ALBUM_ID in $ALBUMS; do
            echo "üîÑ Indexando √°lbum: $ALBUM_ID"
            curl -X POST "https://dev.uvfotoevideo.com.br/api/albums/$ALBUM_ID/process-images" \
                 -H "Content-Type: application/json" \
                 --max-time 300 \
                 --retry 3 \
                 --retry-delay 10
            
            # Aguarda 5 segundos entre cada √°lbum
            echo "‚è≥ Aguardando 5 segundos..."
            sleep 5
          done
          
          echo "‚úÖ Indexa√ß√£o completa!"
